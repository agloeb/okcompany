<!DOCTYPE html>
<html>
<head>
    <title>half-mile</title>
    <link rel="stylesheet" href="crap.css">
</head>
<body>
    <div class="text">
        <p id="piece">saw it on the tube bought it on the phone now yer home alone with a <a href="crap.html" id="crap">piece of crap</a></p>
    </div>
    <canvas id="textCanvas"></canvas>
    <img src="img/STEPracer.gif" class="bkg">
    <script>
        function randomizePixels() {
            const pieceElement = document.getElementById('piece');
            const canvas = document.getElementById('textCanvas');
            const ctx = canvas.getContext('2d');

            const rect = pieceElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            ctx.font = '10px BIZGothic'; 
            ctx.fillStyle = 'rgb(68, 68, 205)';
            ctx.textBaseline = 'top';
            const maxWidth = canvas.width;

            function wrapText(text, x, y, maxWidth) {
                let words = text.split(' ');
                let line = '';
                let lineHeight = parseInt(window.getComputedStyle(pieceElement).fontSize, 10);

                for (let n = 0; n < words.length; n++) {
                    let testLine = line + words[n] + ' ';
                    let testWidth = ctx.measureText(testLine).width;

                    if (testWidth > maxWidth && n > 0) {
                        ctx.fillText(line, x, y);
                        line = words[n] + ' ';
                        y += lineHeight;
                    } else {
                        line = testLine;
                    }
                }
                ctx.fillText(line, x, y);
            }

            wrapText(pieceElement.innerText, 0, 0, maxWidth);

            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const data = imageData.data;

            const numPixelsToRemove = 1000; 
            for (let i = 0; i < numPixelsToRemove; i++) {
                const x = Math.floor(Math.random() * canvas.width);
                const y = Math.floor(Math.random() * canvas.height);
                const index = (y * canvas.width + x) * 4;

                data[index + 3] = 0;
            }

            ctx.putImageData(imageData, 0, 0);
        }

        window.onload = function() {
            randomizePixels();
            setInterval(randomizePixels, 300); 
        }
    </script>
</body>
</html>